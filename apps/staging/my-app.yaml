apiVersion: core.oam.dev/v1beta1
kind: Application
metadata:
  name: my-app
  namespace: default
spec:
  components:
    - name: my-server
      type: webservice
      properties:
        image: ghcr.io/fogdong/test-fog:master-7f5ecb30-1632733303 # {"$imagepolicy": "default:apps"}
        port: 8088
        env:
          - name: DB_HOST
            value: mysql-cluster-mysql.default.svc.cluster.local:3306
          - name: DB_PASSWORD
            valueFrom:
              secretKeyRef:
                name: mysql-secret
                key: ROOT_PASSWORD
      traits:
        - type: ingress
          properties:
            domain: testsvc.example.com
            http:
              /: 8088

# policies:
#   - name: env-policy
#     type: env-binding
#     properties:
#       envs:
#         - name: staging
#           placement: # 选择要部署的集群
#             clusterSelector:
#               name: cluster-staging
#           selector: # 选择要使用的组件
#             components:
#               - my-server

# workflow:
#   steps:
#     # 部署到预发环境中
#     - name: deploy-staging
#       type: deploy2env
#       properties:
#         policy: env-policy
#         env: staging
