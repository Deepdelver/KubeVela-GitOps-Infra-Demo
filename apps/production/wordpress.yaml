apiVersion: core.oam.dev/v1beta1
kind: Application
metadata:
  name: wordpress
  namespace: default
spec:
  components:
    - name: wordpress
      type: helm
      properties:
        repoType: helm
        url: https://charts.bitnami.com/bitnami
        chart: wordpress
        version: "12.0.3"
        values:
          mariadb:
            enabled: false
          externalDatabase:
            host: my-cluster-mysql.mysql.svc.cluster.local
            user: root
            password: my-pass
            database: mysql
            port: 3306
          service:
            type: ClusterIP
          ingress:
            enabled: true

  policies:
    - name: env-policy
      type: env-binding
      properties:
        envs:
          - name: prod
            placement:
              clusterSelector:
                name: cluster-prod
            selector:
              components:
                - wordpress

  workflow:
    steps:
      # 部署到预发环境中
      - name: deploy-staging
        type: deploy2env
        properties:
          policy: env-policy
          env: prod